<section class="content-header">
	<h1>
		4S店 <small th:text="${store4S==null?'':store4S.name}">4S店</small>
		<input type="hidden" value="" id="store4SIdInput" th:value="${store4S==null?'':store4S.id}" />
	</h1>
	<ol class="breadcrumb">
		<li><a href="#page/center/home"><i class="fa fa-home"></i> Home</a></li>
		<li><a href="#page/obd/store4S/store4SList"><i class="glyphicon glyphicon-list"></i> 4S店列表</a></li>
		<li class="active" >查看4S店</li>
	</ol>
</section>

<!-- Main content -->
<section class="content" th:inline="text">
	<div class="mailbox-controls">
		<div class="btn-group btn-group-sm">
			<button aria-expanded="false" aria-haspopup="true" data-toggle="dropdown" class="btn btn-primary dropdown-toggle" type="button">
				操作
				<span class="ion-arrow-down-b"></span>
			</button>
			<ul class="dropdown-menu pull-right">
				<li><a href="javascript:;" id="deleteButton">
						<i class="glyphicon glyphicon-remove"></i>移除
					</a></li>
			</ul>
		</div>
		<!-- /.btn-group -->
		<button type="button" class="btn btn-warning btn-sm" onclick="history.back(-1)">
			<i class="fa fa-reply"></i>
		</button>
	</div>
	<div class="row">
		<div class="col-md-12">

			<!-- Profile Image -->
			<div class="box box-primary">
				<div class="box-body box-profile">
					<h3 class="profile-username text-center" th:text="${store4S==null?'':store4S.name}">4S店*</h3>
					<dl>
						<dt>电话</dt>
						<dd th:text="${store4S==null?'':store4S.phone}"></dd>
						<dt>地址</dt>
						<dd th:text="${store4S==null?'':store4S.address}"></dd>						
					</dl>
				</div>
				<!-- /.box-body -->
			</div>
			<!-- /.box -->
		</div>
		<!-- /.col -->
		<div  class="col-md-12">
			<div class="box box-solid">
				<div class="box-header with-border">
					<h3 class="box-title">地理位置</h3>
				</div>
				<!-- /.box-header -->
				<div class="box-body" id="map-container" style="min-height: 500px;"></div>
				<!-- /.box-body -->
			</div>
		</div>
	</div>
</section>
<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=d254ac4661b761ec170e42d7ffb9bdda&plugin=AMap.Autocomplete,AMap.PlaceSearch&callback=init"></script>
<script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
<script>
function init(){    
    var map = null;
    if('[[${store4S==null?'':store4S.lng}]]'!=''){
    	var lng='[[${store4S==null?'':store4S.lng}]]';
    	var lat='[[${store4S==null?'':store4S.lat}]]';
    	map = new AMap.Map('map-container', {
    		 center: [lng, lat],
    	     resizeEnable: true,
    	     scrollWheel:false,
    	     zoom: 16
    	});
    }else{
    	 map = new AMap.Map('map-container', {
    	     resizeEnable: false,
       	     scrollWheel:false
    	 });
    }
    map.plugin(["AMap.ToolBar"], function() {
        map.addControl(new AMap.ToolBar());
    });
    var autoOptions = {
            input: "tipinput"
    };
    var auto = new AMap.Autocomplete(autoOptions);
    var placeSearch = new AMap.PlaceSearch({
        map: map
    });  //构造地点查询类
    AMap.event.addListener(auto, "select", select);//注册监听，当选中某条记录时会触发
    function select(e) {
        placeSearch.setCity(e.poi.adcode);
        placeSearch.search(e.poi.name);  //关键字查询查询
    }
    var contextMenu = new AMap.ContextMenu();  //创建右键菜单
    //右键添加Marker标记
    var lastMarker=null;//默认标记
    if('[[${store4S==null?'':store4S.lng}]]'!=''){
    	var lng='[[${store4S==null?'':store4S.lng}]]';
    	var lat='[[${store4S==null?'':store4S.lat}]]';
    	lastMarker = new AMap.Marker({
    	    position: [lng,lat],
    	    icon:base+"bootstrap/assets/img/map/mark_rs.png",
    	    map: map
    	});
    }
}
</script>
<script type="text/javascript">
	require([ "domReady" ], function(domReady) {
		domReady(function() {
			activeMenu("obd_store4s_list");

			var [[store4S]]Id = $("#[[store4S]]IdInput").val();

			//删除
			$("#deleteButton").on("click", function() {
				$.confirm({
					title : "提示",
					content : "确定删除4S店?",
					confirmButton : "确定",
					cancelButton : "关闭",
					icon : 'fa fa-warning',
					confirmButtonClass : 'btn-warning',
					animation : 'zoom',
					confirm : function() {
						$.post(base + "/obd/store4S/delete", {
							ids : [ [[store4S]]Id ]
						}, function(resp) {
							if (resp.success) {
								$.alert({
									title : false,
									content : "操作成功",
									confirmButton : "关闭"
								});
								location.href = "#page/obd/store4S/store4SList";
							} else {
								$.alert({
									title : false,
									content : resp.msg,
									confirmButton : "关闭"
								});
							}
						}, "json");
					}
				});
			});

		});
	});
</script>