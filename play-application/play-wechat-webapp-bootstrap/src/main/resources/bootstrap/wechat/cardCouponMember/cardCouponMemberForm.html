<link type="text/css" rel="stylesheet" href="bootstrap/vendor/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css">
<link type="text/css" rel="stylesheet" href="bootstrap/vendor/plugins/select2/select2.min.css">
<link type="text/css" rel="stylesheet" href="//cdn.bootcss.com/bootstrap-fileinput/4.3.3/css/fileinput.min.css">

<section class="content-header">
	<h1>
		会员卡券列表 <small>开始管理会员卡券</small>
	</h1>
	<ol class="breadcrumb">
		<li><a href="#page/center/home"><i class="fa fa-home"></i> Home</a></li>
		<li><a href="#page/wechat/cardCouponMember/cardCouponMemberList"><i class="glyphicon glyphicon-list"></i> 会员卡券列表</a></li>
		<li class="active" th:text="${cardCouponMember==null?'新建会员卡券':'编辑会员卡券'}">新建会员卡券</li>
	</ol>
</section>
<!-- Main content -->
<section class="content" th:inline="text">

	<div class="row">
		<div class="col-xs-12">

			<div class="box box-primary">
				<div class="box-header with-border">
					<h3 class="box-title" th:text="${cardCouponMember==null?'新建会员卡券':'编辑会员卡券'}">新建会员卡券</h3>
				</div>
				<!-- /.box-header -->
				<!-- form start -->
				<form role="form" class="cardcouponmember-form" action="/wechat/cardCouponMember/save">
					<input type="hidden" name="id" th:value="${cardCouponMember==null?'':cardCouponMember.id}" />
					<div class="box-body">
						<div class="form-group">
							<label for="brandNameInput">商户名字</label>
							<input type="text" name="brandName" class="form-control" id="brandNameInput" placeholder="请填写brandName"
								 data-bv-notempty="true" data-bv-notempty-message="请填写brandName"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.brandName}"/>
						</div>
						<div class="form-group">
							<label for="titleInput">卡券名</label>
							<input type="text" name="title" class="form-control" id="titleInput" placeholder="请填写title"
								 data-bv-notempty="true" data-bv-notempty-message="请填写title"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.title}"/>
						</div>
		                <div class="form-group">
							<label for="logoUrlInput">卡券的商户logo</label>
							<input name="logoUrl" type="hidden" data-bv-notempty="true" th:value="${cardCouponMember==null?'':cardCouponMember.logoUrl}">
							<input id="logoUrlInput" name="file" type="file" class="file-loading">
						</div>
						<div class="form-group">
							<label for="backgroudUrlInput">会员卡背景图 1000像素*600像素以下</label>
							<input name="backgroudUrl" type="hidden" data-bv-notempty="true" th:value="${cardCouponMember==null?'':cardCouponMember.backgroudUrl}">
							<input id="backgroudUrlInput" name="file" type="file" class="file-loading">
						</div>
						<div class="form-group">
							<label for="servicePhoneInput">服务电话</label>
							<input type="text" name="servicePhone" class="form-control" id="servicePhoneInput" placeholder="请填写servicePhone"
								
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.servicePhone}"/>
						</div>
						<div class="form-group">
							<label for="noticeInput">卡券使用提醒</label>
							<input type="text" name="notice" class="form-control" id="noticeInput" placeholder="请填写notice"
								 data-bv-notempty="true" data-bv-notempty-message="请填写notice"data-bv-stringlength="true" data-bv-stringlength-min="0" data-bv-stringlength-max="48" data-bv-stringlength-message="个数必须在0和48之间"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.notice}"/>
						</div>
						<div class="form-group">
							<label for="colorInput">券颜色</label>
		                  		<select id="colorInput" name="color" class="form-control" data-bv-notempty="true"
								data-bv-notempty-message="请选择券颜色" >
		                  </select>
						</div>
						<div class="form-group">
							<label for="descriptionInput">卡券使用说明</label>
							<textarea type="text" name="description" class="form-control" id="descriptionInput" rows="3" placeholder="请填写description"
								 data-bv-notempty="true" data-bv-notempty-message="请填写description"data-bv-stringlength="true" data-bv-stringlength-min="0" data-bv-stringlength-max="3072" data-bv-stringlength-message="个数必须在0和3072之间"
		                  		th:text="${cardCouponMember==null?'':cardCouponMember.description}"/>
						</div>
						<div class="form-group">
							<label for="skuQuantityInput">会员卡数量</label>
							<input type="text" name="skuQuantity" class="form-control" id="skuQuantityInput" placeholder="请填写skuQuantity"
								 data-bv-notempty="true" data-bv-notempty-message="请填写skuQuantity"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.skuQuantity}"/>
						</div>
						<div class="form-group">
							<label for="prerogativeInput">会员卡特权说明</label>
							<textarea type="text" name="prerogative" class="form-control" id="prerogativeInput" rows="3" placeholder="请填写prerogative"
								 data-bv-notempty="true" data-bv-notempty-message="请填写prerogative"data-bv-stringlength="true" data-bv-stringlength-min="0" data-bv-stringlength-max="1024" data-bv-stringlength-message="个数必须在0和1024之间"
		                  		th:text="${cardCouponMember==null?'':cardCouponMember.prerogative}"/>
						</div>
						<div class="form-group">
							<label for="init_increase_bonusInput">初始积分</label>
							<input type="text" name="init_increase_bonus" class="form-control" id="init_increase_bonusInput" placeholder="请填写init_increase_bonus"
								 data-bv-notempty="true" data-bv-notempty-message="请填写init_increase_bonus"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.init_increase_bonus}"/>
						</div>
						<div class="form-group">
							<label for="cost_money_unitInput">消费金额(单位/分)</label>
							<input type="text" name="cost_money_unit" class="form-control" id="cost_money_unitInput" placeholder="请填写cost_money_unit"
								 data-bv-notempty="true" data-bv-notempty-message="请填写cost_money_unit"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.cost_money_unit}"/>
						</div>
						<div class="form-group">
							<label for="increase_bonusInput">增加的积分</label>
							<input type="text" name="increase_bonus" class="form-control" id="increase_bonusInput" placeholder="请填写increase_bonus"
								 data-bv-notempty="true" data-bv-notempty-message="请填写increase_bonus"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.increase_bonus}"/>
						</div>
						<div class="form-group">
							<label for="max_increase_bonusInput">单次获取积分上限</label>
							<input type="text" name="max_increase_bonus" class="form-control" id="max_increase_bonusInput" placeholder="请填写max_increase_bonus"
								 data-bv-notempty="true" data-bv-notempty-message="请填写max_increase_bonus"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.max_increase_bonus}"/>
						</div>
						<div class="form-group">
							<label for="cost_bonus_unitInput">每使用积分</label>
							<input type="text" name="cost_bonus_unit" class="form-control" id="cost_bonus_unitInput" placeholder="请填写cost_bonus_unit"
								 data-bv-notempty="true" data-bv-notempty-message="请填写cost_bonus_unit"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.cost_bonus_unit}"/>
						</div>
						<div class="form-group">
							<label for="reduce_moneyInput">抵扣xx元（单位/分)</label>
							<input type="text" name="reduce_money" class="form-control" id="reduce_moneyInput" placeholder="请填写reduce_money"
								 data-bv-notempty="true" data-bv-notempty-message="请填写reduce_money"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.reduce_money}"/>
						</div>
						<div class="form-group">
							<label for="least_money_to_use_bonusInput">抵扣条件，满xx元（单位/分）可用</label>
							<input type="text" name="least_money_to_use_bonus" class="form-control" id="least_money_to_use_bonusInput" placeholder="请填写least_money_to_use_bonus"
								 data-bv-notempty="true" data-bv-notempty-message="请填写least_money_to_use_bonus"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.least_money_to_use_bonus}"/>
						</div>
						<div class="form-group">
							<label for="max_reduce_bonusInput">抵扣条件，单笔最多使用xx积分</label>
							<input type="text" name="max_reduce_bonus" class="form-control" id="max_reduce_bonusInput" placeholder="请填写max_reduce_bonus"
								 data-bv-notempty="true" data-bv-notempty-message="请填写max_reduce_bonus"
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.max_reduce_bonus}"/>
						</div>
						<div class="form-group">
							<label for="discountInput">折扣，该会员卡享受的折扣优惠,填10就是九折。</label>
							<input type="text" name="discount" class="form-control" id="discountInput" placeholder="请填写discount"
								
		                  		th:value="${cardCouponMember==null?'':cardCouponMember.discount}"/>
						</div>
						
					</div>
					<!-- /.box-body -->

					<div class="box-footer">
						<button type="button" class="btn btn-default" onclick="location.href='#/page/wechat/cardCoupon/cardCouponList'">返回列表</button>
						<button type="submit" class="btn btn-primary pull-right">保存</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</section>

<script type="text/javascript">
	require([ "domReady","datetimepickerzh","select2zh","fileinputzh","kindeditor"], function(domReady) {
		domReady(function() {
			activeMenu("wechat_cardcouponmember_list");
			
			
			function formatRepo (repo) {
			      if (repo.loading) return repo.text;
			      var markup = "<div style='background-color:"+repo.data+"'>" +repo.text+"</div>";
			      return markup;
			}
			/* function formatRepoSelection (repo) {
			      return repo.text + repo.data;
			} */
			$typeSelect=$("#colorInput").select2({
		    	placeholder: '---请选择卡券颜色---',
		    	data:[{id:'Color010',text:'Color010',data:'#63b359'},{id:'Color020',text:'Color020',data:'#2c9f67'},{id:'Color030',text:'Color030',data:'#509fc9'},
		    		{id:'Color040',text:'Color040',data:'#5885cf'},{id:'Color050',text:'Color050',data:'#9062c0'},{id:'Color060',text:'Color060',data:'#d09a45'},
		    		{id:'Color070',text:'Color070',data:'#e4b138'},{id:'Color080',text:'Color080',data:'#ee903c'},{id:'Color081',text:'Color081',data:'#f08500'},
		    		{id:'Color082',text:'Color082',data:'#a9d92d'},{id:'Color090',text:'Color090',data:'#dd6549'},
		    		{id:'Color100',text:'Color100',data:'#cc463d'},{id:'Color101',text:'Color101',data:'#cf3e36'},{id:'Color102',text:'Color102',data:'#5E6671'}],
		    		 escapeMarkup: function (markup) { return markup; },
		    		templateResult: formatRepo//,
		    		//templateSelection: formatRepoSelection
			});
		    $typeSelect.val("[[${cardCouponMember==null?'':cardCouponMember.color}]]").trigger("change");
		    
			var logoUrlIcon = "[[${cardCouponMember==null?'':cardCouponMember.logoUrl}]]";
			var $logoUrlInput = $("#logoUrlInput");
			$logoUrlInput.fileinput({
				overwriteInitial : true,
				language : "zh",
				uploadUrl : base + "/center/multipart/upload",
				maxFileSize : 1500,
				showClose : false,
				showCaption : false,
				multiple : false,
				showUpload : false, // hide upload button
				showRemove : false, // hide remove button
				minFileCount : 1,
				maxFileCount : 1,
				elErrorContainer : '#kv-logoUrl-errors-1',
				msgErrorClass : 'alert alert-block alert-danger',
				defaultPreviewContent : logoUrlIcon&&logoUrlIcon!="" ?"<img src='"+logoUrlIcon+"' alt='头像' style='width:160px'>":"<img src='' alt='头像' style='width:160px'>",
				allowedFileTypes : [ "image" ]
			}).on("filebatchselected", function(event, files) {
				$logoUrlInput.fileinput("upload");
			}).on('fileuploaded', function(event, data, previewId, index) {
				var form = data.form, files = data.files, extra = data.extra, response = data.response, reader = data.reader;
				if (response.success) {
					var $form = $(".cardcouponmember-form");
					$form.find("input[name=logoUrl]").val(response.urls);
				}
			});

			var backgroudUrlIcon = "[[${cardCouponMember==null?'':cardCouponMember.backgroudUrl}]]";
			var $backgroudUrlInput = $("#backgroudUrlInput");
			$backgroudUrlInput.fileinput({
				overwriteInitial : true,
				language : "zh",
				uploadUrl : base + "/center/multipart/upload",
				maxFileSize : 1500,
				showClose : false,
				showCaption : false,
				multiple : false,
				showUpload : false, // hide upload button
				showRemove : false, // hide remove button
				minFileCount : 1,
				maxFileCount : 1,
				elErrorContainer : '#kv-logoUrl-errors-1',
				msgErrorClass : 'alert alert-block alert-danger',
				defaultPreviewContent : backgroudUrlIcon&&backgroudUrlIcon!="" ?"<img src='"+backgroudUrlIcon+"' alt='头像' style='width:160px'>":"<img src='' alt='头像' style='width:160px'>",
				allowedFileTypes : [ "image" ]
			}).on("filebatchselected", function(event, files) {
				$backgroudUrlInput.fileinput("upload");
			}).on('fileuploaded', function(event, data, previewId, index) {
				var form = data.form, files = data.files, extra = data.extra, response = data.response, reader = data.reader;
				if (response.success) {
					var $form = $(".cardcouponmember-form");
					$form.find("input[name=backgroudUrl]").val(response.urls);
				}
			});
			var $form = $(".cardcouponmember-form");		  
			$(".cardcouponmember-form").bootstrapValidator().on('success.form.bv', function(e) {
				e.preventDefault();
				var $form = $(e.target);
				var bv = $form.data('bootstrapValidator');
				console.log("");
				$.post($form.attr('action'), $form.serialize(), function(result) {
					if (result.success) {
						$.alert({
							title : false,
							closeIcon: true,
							content : "保存成功",
							confirmButton : "返回列表",
							confirm : function() {
								location.href = "#/page/wechat/cardCoupon/cardCouponList";
							}
						});

					} else {
						$.alert({
							title : false,
							content : result.msg,
							confirmButton : "关闭"
						});
						$form.bootstrapValidator('disableSubmitButtons', false);
					}
				}, 'json');
			});
		});
	});
</script>